name: CI/CD Pipeline

on: [push, pull_request, workflow_dispatch]

permissions:
  # allows SonarCloud to decorate PRs with analysis results
  pull-requests: read


jobs:
  MavenTest:

    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up JDK 21
        uses: actions/setup-java@v3
        with:
          java-version: '21'
          distribution: 'oracle'
          cache: maven

      - name: Format source code
        run: mvn format:formatter

      - name: Test with Maven
        run: mvn clean test

  SonarAnalysis:

      runs-on: ubuntu-latest

      steps:
          - name: Analyze with SonarCloud

            uses: SonarSource/sonarcloud-github-action@v.2.2.0

            env:
              # Generate a token on Sonarcloud.io, add it to the secrets of this repo with the name SONAR_TOKEN (Settings > Secrets > Actions > add new repository secret)
              SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
            with:
              args:
                 # Unique keys of your project and organization. You can find them in SonarCloud > Information (bottom-left menu)
                 # mandatory
                -Dsonar.projectKey=
                -Dsonar.organization=
              projectBaseDir: 'src/main/java/greencity'